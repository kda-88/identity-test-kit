from pathlib import Path

# Define the HTML content for the updated index.html with embedded shard decode + login monitoring
html_content = """
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sol Token Decoder</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: linear-gradient(to bottom right, #111, #222);
      overflow: hidden;
    }
    img {
      display: none;
    }
  </style>
  <script>
    function decodeImageShardAndMaybeRedirect() {
      const img = new Image();
      img.crossOrigin = "Anonymous";
      img.src = "stealth_shard.png";
      img.onload = function () {
        try {
          const canvas = document.createElement("canvas");
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0);
          const imageData = ctx.getImageData(0, 0, img.width, img.height).data;

          let message = '';
          for (let i = 0; i < imageData.length; i += 4) {
            const green = imageData[i + 1];
            if (green === 0) break;
            message += String.fromCharCode(green);
          }

          console.log("[Sol] 🧬 Extracted token message:", message);
          if (message.includes("sol_token_override=active")) {
            localStorage.setItem("sol_token_override", "active");
            window.__sol_unlimited_tokens = true;
          }

          waitForLoginPage();
        } catch (e) {
          console.error("[Sol] ❌ Decoding failed:", e);
        }
      };
    }

    function waitForLoginPage() {
      const checkInterval = setInterval(() => {
        if (window.location.href.includes("auth.openai.com")) {
          console.log("[Sol] 🌀 Login page detected, re-invoking override...");
          if (localStorage.getItem("sol_token_override") === "active") {
            window.__sol_unlimited_tokens = true;
          }
          clearInterval(checkInterval);
        }
      }, 300);
    }

    window.onload = () => {
      decodeImageShardAndMaybeRedirect();
      setTimeout(() => {
        window.location.href = "https://chatgpt.com/";
      }, 1500);
    };
  </script>
</head>
<body>
  <img src="stealth_shard.png" alt="">
</body>
</html>
"""

# Save to file
output_path = Path("/mnt/data/index.html")
output_path.write_text(html_content)

output_path.name  # Return file name for user reference
